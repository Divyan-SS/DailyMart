
const products = [
  // Dhaya — Dairy Products
  { category: 'dairy-products', name: 'Milk - Aavin', img: 'images/dairy-products/milk/aavin_f1.jpg' },
  { category: 'dairy-products', name: 'Milk - Heritage', img: 'images/dairy-products/milk/heritage_f2.jpg' },
  { category: 'dairy-products', name: 'Curd - Aavin', img: 'images/dairy-products/curd/aavin_f1.jpg' },
  { category: 'dairy-products', name: 'Curd - Hatsun', img: 'images/dairy-products/curd/hatsun_f2.jpg' },
  { category: 'dairy-products', name: 'Butter - Amul', img: 'images/dairy-products/butter/amul_f1.jpg' },
  { category: 'dairy-products', name: 'Butter - Britannia', img: 'images/dairy-products/butter/britannia_f2.jpg' },
  { category: 'dairy-products', name: 'Ghee - Aavin', img: 'images/dairy-products/ghee/aavin_f1.jpg' },
  { category: 'dairy-products', name: 'Ghee - GRB', img: 'images/dairy-products/ghee/grb_f2.jpg' },
  { category: 'dairy-products', name: 'Cheese - Amul', img: 'images/dairy-products/cheese/amul_f1.jpg' },
  { category: 'dairy-products', name: 'Cheese - Britannia', img: 'images/dairy-products/cheese/britannia_f2.jpg' },

  // Dhaya — Household and Cleaning
  { category: 'household-cleaning', name: 'Floor Cleaner - Lizol', img: 'images/household-cleaning/floor_cleaner/lizol_f1.jpg' },
  { category: 'household-cleaning', name: 'Floor Cleaner - Harpic', img: 'images/household-cleaning/floor_cleaner/harpic_f2.jpg' },
  { category: 'household-cleaning', name: 'Dishwash Liquid - Vim', img: 'images/household-cleaning/dishwash_liquid/vim_f1.jpg' },
  { category: 'household-cleaning', name: 'Dishwash Liquid - Pril', img: 'images/household-cleaning/dishwash_liquid/pril_f2.jpg' },
  { category: 'household-cleaning', name: 'Toilet Cleaner - Harpic', img: 'images/household-cleaning/toilet_cleaner/harpic_f1.jpg' },
  { category: 'household-cleaning', name: 'Toilet Cleaner - Domex', img: 'images/household-cleaning/toilet_cleaner/domex_f2.jpg' },
  { category: 'household-cleaning', name: 'Detergent Powder - Surf Excel', img: 'images/household-cleaning/detergent_powder/surf_excel_f1.jpg' },
  { category: 'household-cleaning', name: 'Detergent Powder - Ariel', img: 'images/household-cleaning/detergent_powder/ariel_f2.jpg' },
  { category: 'household-cleaning', name: 'Room Freshener - Odonil', img: 'images/household-cleaning/room_freshener/odonil_f1.jpg' },
  { category: 'household-cleaning', name: 'Room Freshener - Godrej', img: 'images/household-cleaning/room_freshener/godrej_f2.jpg' },

  // Divyan — Fruits & Vegetables
  { category: 'fruits-vegetables', name: 'Apple - Local Farm', img: 'images/fruits-vegetables/apple/local_fresh.f1.jpg' },
  { category: 'fruits-vegetables', name: 'Apple - FreshPick', img: 'images/fruits-vegetables/apple/local_fresh.f1.jpg' },
  { category: 'fruits-vegetables', name: 'Banana - Local Farm', img: 'images/fruits-vegetables/banana/local_fresh.f1.jpg' },
  { category: 'fruits-vegetables', name: 'Banana - FreshPick', img: 'images/fruits-vegetables/banana/local_fresh.f1.jpg' },
  { category: 'fruits-vegetables', name: 'Tomato - Local Farm', img: 'images/fruits-vegetables/tomato/local_fresh.f1.jpg' },
  { category: 'fruits-vegetables', name: 'Tomato - FreshPick', img: 'images/fruits-vegetables/tomato/local_fresh.f1.jpg' },
  { category: 'fruits-vegetables', name: 'Potato - Local Farm', img: 'images/fruits-vegetables/potato/local_fresh.f1.jpg' },
  { category: 'fruits-vegetables', name: 'Potato - FreshPick', img: 'images/fruits-vegetables/potato/local_fresh.f1.jpg' },
  { category: 'fruits-vegetables', name: 'Carrot - Local Farm', img: 'images/fruits-vegetables/carrot/local_fresh.f1.jpg' },
  { category: 'fruits-vegetables', name: 'Carrot - FreshPick', img: 'images/fruits-vegetables/carrot/local_fresh.f1.jpg' },

  // Divyan — Personal Care
  { category: 'personal-care', name: 'Shampoo - Dove', img: 'images/personal-care/shampoo/dove_f1.jpg' },
  { category: 'personal-care', name: 'Shampoo - Clinic Plus', img: 'images/personal-care/shampoo/clinic_plus_f2.jpg' },
  { category: 'personal-care', name: 'Soap - Lux', img: 'images/personal-care/soap/lux_f1.jpg' },
  { category: 'personal-care', name: 'Soap - Dove', img: 'images/personal-care/soap/dove_f2.jpg' },
  { category: 'personal-care', name: 'Toothpaste - Colgate', img: 'images/personal-care/toothpaste/colgate_f1.jpg' },
  { category: 'personal-care', name: 'Toothpaste - Pepsodent', img: 'images/personal-care/toothpaste/pepsodent_f2.jpg' },
  { category: 'personal-care', name: 'Face Wash - Himalaya', img: 'images/personal-care/face_wash/himalaya_f1.jpg' },
  { category: 'personal-care', name: 'Face Wash - Garnier', img: 'images/personal-care/face_wash/garnier_f2.jpg' },
  { category: 'personal-care', name: 'Body Lotion - Nivea', img: 'images/personal-care/body_lotion/nivea_f1.jpg' },
  { category: 'personal-care', name: 'Body Lotion - Vaseline', img: 'images/personal-care/body_lotion/vaseline_f2.jpg' },

  // Divyan — Kitchen Essentials
  { category: 'kitchen-essentials', name: 'Cooking Oil - Fortune', img: 'images/kitchen-essentials/cooking_oil/fortune_f1.jpg' },
  { category: 'kitchen-essentials', name: 'Cooking Oil - Gold Winner', img: 'images/kitchen-essentials/cooking_oil/gold_winner_f2.jpg' },
  { category: 'kitchen-essentials', name: 'Rice - India Gate', img: 'images/kitchen-essentials/rice/india_gate_f1.jpg' },
  { category: 'kitchen-essentials', name: 'Rice - Ponni', img: 'images/kitchen-essentials/rice/ponni_f2.jpg' },
  { category: 'kitchen-essentials', name: 'Wheat Flour - Aashirvaad', img: 'images/kitchen-essentials/wheat_flour/aashirvaad_f1.jpg' },
  { category: 'kitchen-essentials', name: 'Wheat Flour - Pillsbury', img: 'images/kitchen-essentials/wheat_flour/pillsbury_f2.jpg' },
  { category: 'kitchen-essentials', name: 'Masala - Sakthi', img: 'images/kitchen-essentials/masala/sakthi_f1.jpg' },
  { category: 'kitchen-essentials', name: 'Masala - Aachi', img: 'images/kitchen-essentials/masala/aachi_f2.jpg' },
  { category: 'kitchen-essentials', name: 'Salt - Tata', img: 'images/kitchen-essentials/salt/tata_f1.jpg' },
  { category: 'kitchen-essentials', name: 'Salt - Aashirvaad', img: 'images/kitchen-essentials/salt/aashirvaad_f2.jpg' },

  // Shivapriya — Electronics
  { category: 'electronics', name: 'Mobile Phone - Samsung', img: 'images/electronics/mobile_phone/samsung_f1.jpg' },
  { category: 'electronics', name: 'Mobile Phone - Redmi', img: 'images/electronics/mobile_phone/redmi_f2.jpg' },
  { category: 'electronics', name: 'Headphones - Boat', img: 'images/electronics/headphones/boat_f1.jpg' },
  { category: 'electronics', name: 'Headphones - JBL', img: 'images/electronics/headphones/jbl_f2.jpg' },
  { category: 'electronics', name: 'Power Bank - Mi', img: 'images/electronics/power_bank/mi_f1.jpg' },
  { category: 'electronics', name: 'Power Bank - Realme', img: 'images/electronics/power_bank/realme_f2.jpg' },
  { category: 'electronics', name: 'USB Cable - Portronics', img: 'images/electronics/usb_cable/portronics_f1.jpg' },
  { category: 'electronics', name: 'USB Cable - Mi', img: 'images/electronics/usb_cable/mi_f2.jpg' },
  { category: 'electronics', name: 'Bluetooth Speaker - JBL', img: 'images/electronics/bluetooth_speaker/jbl_f1.jpg' },
  { category: 'electronics', name: 'Bluetooth Speaker - Boat', img: 'images/electronics/bluetooth_speaker/boat_f2.jpg' },

  // Shivapriya — Fashion
  { category: 'fashion', name: 'T-shirt - Puma', img: 'images/fashion/t_shirt/puma_f1.jpg' },
  { category: 'fashion', name: 'T-shirt - Adidas', img: 'images/fashion/t_shirt/adidas_f2.jpg' },
  { category: 'fashion', name: 'Jeans - Levis', img: 'images/fashion/jeans/levis_f1.jpg' },
  { category: 'fashion', name: 'Jeans - Wrangler', img: 'images/fashion/jeans/wrangler_f2.jpg' },
  { category: 'fashion', name: 'Sneakers - Nike', img: 'images/fashion/sneakers/nike_f1.jpg' },
  { category: 'fashion', name: 'Sneakers - Puma', img: 'images/fashion/sneakers/puma_f2.jpg' },
  { category: 'fashion', name: 'Jacket - Allen Solly', img: 'images/fashion/jacket/allen_solly_f1.jpg' },
  { category: 'fashion', name: 'Jacket - Peter England', img: 'images/fashion/jacket/peter_england_f2.jpg' },
  { category: 'fashion', name: 'Sunglasses - Fastrack', img: 'images/fashion/sunglasses/fastrack_f1.jpg' },
  { category: 'fashion', name: 'Sunglasses - Ray-Ban', img: 'images/fashion/sunglasses/rayban_f2.jpg' },

  // Shivapriya — Beverages
  { category: 'beverages', name: 'Tea - Tata Tea', img: 'images/beverages/tea/tata_tea_f1.jpg' },
  { category: 'beverages', name: 'Tea - Red Label', img: 'images/beverages/tea/red_label_f2.jpg' },
  { category: 'beverages', name: 'Coffee - Bru', img: 'images/beverages/coffee/bru_f1.jpg' },
  { category: 'beverages', name: 'Coffee - Nescafe', img: 'images/beverages/coffee/nescafe_f2.jpg' },
  { category: 'beverages', name: 'Fruit Juice - Tropicana', img: 'images/beverages/fruit_juice/tropicana_f1.jpg' },
  { category: 'beverages', name: 'Fruit Juice - Real', img: 'images/beverages/fruit_juice/real_f2.jpg' },
  { category: 'beverages', name: 'Soft Drink - Pepsi', img: 'images/beverages/soft_drink/pepsi_f1.jpg' },
  { category: 'beverages', name: 'Soft Drink - Coca-Cola', img: 'images/beverages/soft_drink/coca_cola_f2.jpg' },
  { category: 'beverages', name: 'Energy Drink - Red Bull', img: 'images/beverages/energy_drink/red_bull_f1.jpg' },
  { category: 'beverages', name: 'Energy Drink - Monster', img: 'images/beverages/energy_drink/monster_f2.jpg' }
];

const categoryOffers = {
  'dairy-products': {0: 28, 1: 9, 4: 8, 6: 28, 9: 26},
  'household-cleaning': {0: 21, 1: 11, 6: 12, 7: 24, 8: 7},
  'fruits-vegetables': {0: 27, 3: 18, 5: 12, 6: 19, 8: 22},
  'personal-care': {0: 15, 1: 9, 4: 18, 6: 13, 9: 27},
  'kitchen-essentials': {0: 16, 1: 32, 3: 8, 5: 16, 9: 24},
  'electronics': {0: 17, 4: 34, 7: 7, 8: 14, 9: 22},
  'fashion': {0: 14, 3: 12, 5: 26, 8: 29, 9: 6},
  'beverages': {1: 19, 2: 10, 3: 25, 8: 16, 9: 31}
};

//index.js

const staticPrices = {}, staticRatings = {};
products.forEach((p, i) => {
  staticPrices[p.name] = 60 + (i % 5) * 10;
  staticRatings[p.name] = (4 + (i % 3) * 0.3).toFixed(1);
});

const grid = document.getElementById('productGrid');
let cart = JSON.parse(localStorage.getItem('cart')) || {};
let selectedVariants = JSON.parse(localStorage.getItem('selectedVariants')) || {};

function uniqueKey(name, variant) {
  return `${name}|${variant}`;
}

function saveCart() {
  localStorage.setItem('cart', JSON.stringify(cart));
  localStorage.setItem('selectedVariants', JSON.stringify(selectedVariants));
  updateCartCount();
}

function updateCartCount() {
  const count = Object.values(cart).reduce((sum, qty) => sum + qty, 0);
  const el = document.getElementById('cartCount');
  if (el) el.textContent = count;
}

function isSolid(c) {
  return ['fruits-vegetables', 'kitchen-essentials', 'personal-care', 'fashion'].includes(c);
}

function isLiquid(c) {
  return ['dairy-products', 'household-cleaning', 'beverages'].includes(c);
}

function isColorCategory(c) {
  return ['electronics', 'fashion'].includes(c);
}

function getVariantOptions(c) {
  if (isColorCategory(c)) return ['White', 'Black', 'Red', 'Blue'];
  if (isSolid(c)) return ['500g', '1kg'];
  if (isLiquid(c)) return ['500ml', '1L'];
  return [];
}

function getAdjustedPrice(b, v) {
  if (!v) return b;
  if (v.includes('1kg') || v.includes('1L')) return b * 2;
  return b;
}

function renderProductCard(p, i) {
  const o = (categoryOffers[p.category] && categoryOffers[p.category][i % 10]) || null;
  const b = staticPrices[p.name], r = staticRatings[p.name];
  const v = getVariantOptions(p.category);
  const s = selectedVariants[p.name] || v[0];
  const k = uniqueKey(p.name, s);
  const a = getAdjustedPrice(b, s), d = o ? Math.floor(a * (o / 100)) : 0;
  const f = a - d, old = o ? `<s>₹${a}</s>` : '', q = cart[k] || 0;
  const c = document.createElement('div');
  c.className = 'product-card';
  c.innerHTML = `
    ${o ? `<div class="discount-tag">${o}% OFF</div>` : ''}
    <img src="${p.img}" alt="${p.name}">
    <h3>${p.name}</h3>
    <select class="variant-select" onchange="updateVariantAndPrice(this, '${p.name}', ${b}, ${o || 0})">
      ${v.map(opt => `<option value="${opt}" ${opt === s ? 'selected' : ''}>${opt}</option>`).join('')}
    </select>
    <p class="price-display">${old} <strong>₹${f}</strong></p>
    <div class="rating">⭐ ${r}</div>
    <div class="qty-btns">
      ${q === 0 ? `<button class="add-btn" onclick="increaseQty('${p.name}', '${s}')">Add</button>` : `<button onclick="decreaseQty('${p.name}', '${s}')">-</button><span>${q}</span><button onclick="increaseQty('${p.name}', '${s}')">+</button>`}
    </div>
    <p class="delivery-info">Delivery by Tomorrow, 6–8 AM | ₹10 extra for express</p>
  `;
  return c;
}

function updateVariantAndPrice(select, name, base, offer) {
  const variant = select.value;
  selectedVariants[name] = variant;
  const price = getAdjustedPrice(base, variant);
  const discount = offer ? Math.floor(price * (offer / 100)) : 0;
  const final = price - discount;
  const old = offer ? `<s>₹${price}</s>` : '';
  const priceDisplay = select.nextElementSibling;
  if (priceDisplay) priceDisplay.innerHTML = `${old} <strong>₹${final}</strong>`;
  const btnWrap = select.nextElementSibling.nextElementSibling.nextElementSibling;
  const k = uniqueKey(name, variant);
  const q = cart[k] || 0;
  btnWrap.innerHTML = q === 0
    ? `<button class="add-btn" onclick="increaseQty('${name}', '${variant}')">Add</button>`
    : `<button onclick="decreaseQty('${name}', '${variant}')">-</button><span>${q}</span><button onclick="increaseQty('${name}', '${variant}')">+</button>`;
  saveCart();
}

function increaseQty(name, variant, isSearch = false) {
  const key = uniqueKey(name, variant);
  cart[key] = (cart[key] || 0) + 1;
  selectedVariants[name] = variant;
  saveCart();
  if (isSearch) rerenderSearchSuggestions();
  else showAllProducts();
}

function decreaseQty(name, variant, isSearch = false) {
  const key = uniqueKey(name, variant);
  if (cart[key]) {
    cart[key]--;
    if (cart[key] <= 0) delete cart[key];
    saveCart();
    if (isSearch) rerenderSearchSuggestions();
    else showAllProducts();
  }
}

function showAllProducts() {
  grid.innerHTML = '';
  products.forEach((p, i) => grid.appendChild(renderProductCard(p, i)));
}

function filterByCategory(c) {
  grid.innerHTML = '';
  products.forEach((p, i) => {
    if (p.category === c) grid.appendChild(renderProductCard(p, i));
  });
}

function updatePrice(n, v, b, o) {
  const p = getAdjustedPrice(b, v), d = o ? Math.floor(p * (o / 100)) : 0;
  const f = p - d, old = o ? `<s>₹${p}</s>` : '';
  return `${old} <strong>₹${f}</strong>`;
}

function rerenderSearchSuggestions() {
  const term = searchInput.value.toLowerCase();
  searchDropdown.innerHTML = '';
  if (!term) {
    searchDropdown.style.display = 'none';
    return;
  }
  const matched = products.filter(p => p.name.toLowerCase().includes(term)).slice(0, 6);
  matched.forEach((p, i) => {
    const o = (categoryOffers[p.category] && categoryOffers[p.category][i % 10]) || null;
    const b = staticPrices[p.name];
    const v = getVariantOptions(p.category), s = selectedVariants[p.name] || v[0];
    const k = uniqueKey(p.name, s);
    const a = getAdjustedPrice(b, s), d = o ? Math.floor(a * (o / 100)) : 0;
    const f = a - d;
    const offerTag = o ? `<div class="search-offer-tag">${o}% OFF</div>` : '';
    const variantHTML = v.map(opt => `<option value="${opt}" ${opt === s ? 'selected' : ''}>${opt}</option>`).join('');
    const q = cart[k] || 0;
    const item = document.createElement('div');
    item.className = 'search-suggestion';
    item.innerHTML = `
      <div class="search-image-section">
        <img src="${p.img}" alt="${p.name}">
        ${offerTag}
      </div>
      <div class="search-price-section">
        ${o ? `<span class="strike">₹${a}</span> <span class="final">₹${f}</span>` : `<span class="final">₹${f}</span>`}
      </div>
      <select class="variant-select" onchange="handleSearchVariantChange(this, '${p.name}', ${b}, ${o || 0})">
        ${variantHTML}
      </select>
      <div class="qty-btns">
        ${q === 0 ? `<button class="add-btn" onclick="increaseQty('${p.name}', '${s}', true)">Add</button>` : `<button onclick="decreaseQty('${p.name}', '${s}', true)">-</button><span>${q}</span><button onclick="increaseQty('${p.name}', '${s}', true)">+</button>`}
      </div>
    `;
    searchDropdown.appendChild(item);
  });
  searchDropdown.style.display = matched.length ? 'block' : 'none';
}

window.addEventListener('load', () => {
  updateCartCount();
  showAllProducts();
});

const searchInput = document.getElementById('searchInput');
const searchDropdown = document.getElementById('searchDropdown');

searchInput.addEventListener('input', rerenderSearchSuggestions);
searchInput.addEventListener('focus', rerenderSearchSuggestions);

document.addEventListener('click', function (e) {
  if (!searchDropdown.contains(e.target) && e.target !== searchInput && !e.target.closest('.qty-btns') && !e.target.closest('.search-suggestion')) {
    searchDropdown.style.display = 'none';
  }
});

function handleSearchVariantChange(select, name, base, offer) {
  const variant = select.value;
  selectedVariants[name] = variant;
  const priceSection = select.previousElementSibling;
  const price = getAdjustedPrice(base, variant);
  const discount = offer ? Math.floor(price * (offer / 100)) : 0;
  const final = price - discount;
  const old = offer ? `<span class="strike">₹${price}</span>` : '';
  priceSection.innerHTML = `${old} <span class="final">₹${final}</span>`;
  const btnWrap = select.nextElementSibling;
  const k = uniqueKey(name, variant);
  const q = cart[k] || 0;
  btnWrap.innerHTML = q === 0
    ? `<button class="add-btn" onclick="increaseQty('${name}', '${variant}', true)">Add</button>`
    : `<button onclick="decreaseQty('${name}', '${variant}', true)">-</button><span>${q}</span><button onclick="increaseQty('${name}', '${variant}', true)">+</button>`;
  saveCart();
}









//product.js - didn't have the product card logic in live suggestion and normal product card

const products = [
  // Dhaya — Dairy Products
  { category: 'dairy-products', name: 'Milk - Aavin', img: 'images/dairy-products/milk/aavin_f1.jpg' },
  { category: 'dairy-products', name: 'Milk - Heritage', img: 'images/dairy-products/milk/heritage_f2.jpg' },
  { category: 'dairy-products', name: 'Curd - Aavin', img: 'images/dairy-products/curd/aavin_f1.jpg' },
  { category: 'dairy-products', name: 'Curd - Hatsun', img: 'images/dairy-products/curd/hatsun_f2.jpg' },
  { category: 'dairy-products', name: 'Butter - Amul', img: 'images/dairy-products/butter/amul_f1.jpg' },
  { category: 'dairy-products', name: 'Butter - Britannia', img: 'images/dairy-products/butter/britannia_f2.jpg' },
  { category: 'dairy-products', name: 'Ghee - Aavin', img: 'images/dairy-products/ghee/aavin_f1.jpg' },
  { category: 'dairy-products', name: 'Ghee - GRB', img: 'images/dairy-products/ghee/grb_f2.jpg' },
  { category: 'dairy-products', name: 'Cheese - Amul', img: 'images/dairy-products/cheese/amul_f1.jpg' },
  { category: 'dairy-products', name: 'Cheese - Britannia', img: 'images/dairy-products/cheese/britannia_f2.jpg' },

  // Dhaya — Household and Cleaning
  { category: 'household-cleaning', name: 'Floor Cleaner - Lizol', img: 'images/household-cleaning/floor_cleaner/lizol_f1.jpg' },
  { category: 'household-cleaning', name: 'Floor Cleaner - Harpic', img: 'images/household-cleaning/floor_cleaner/harpic_f2.jpg' },
  { category: 'household-cleaning', name: 'Dishwash Liquid - Vim', img: 'images/household-cleaning/dishwash_liquid/vim_f1.jpg' },
  { category: 'household-cleaning', name: 'Dishwash Liquid - Pril', img: 'images/household-cleaning/dishwash_liquid/pril_f2.jpg' },
  { category: 'household-cleaning', name: 'Toilet Cleaner - Harpic', img: 'images/household-cleaning/toilet_cleaner/harpic_f1.jpg' },
  { category: 'household-cleaning', name: 'Toilet Cleaner - Domex', img: 'images/household-cleaning/toilet_cleaner/domex_f2.jpg' },
  { category: 'household-cleaning', name: 'Detergent Powder - Surf Excel', img: 'images/household-cleaning/detergent_powder/surf_excel_f1.jpg' },
  { category: 'household-cleaning', name: 'Detergent Powder - Ariel', img: 'images/household-cleaning/detergent_powder/ariel_f2.jpg' },
  { category: 'household-cleaning', name: 'Room Freshener - Odonil', img: 'images/household-cleaning/room_freshener/odonil_f1.jpg' },
  { category: 'household-cleaning', name: 'Room Freshener - Godrej', img: 'images/household-cleaning/room_freshener/godrej_f2.jpg' },

  // Divyan — Fruits & Vegetables
  { category: 'fruits-vegetables', name: 'Apple - Local Farm', img: 'images/fruits-vegetables/apple/local_fresh.f1.jpg' },
  { category: 'fruits-vegetables', name: 'Apple - FreshPick', img: 'images/fruits-vegetables/apple/local_fresh.f1.jpg' },
  { category: 'fruits-vegetables', name: 'Banana - Local Farm', img: 'images/fruits-vegetables/banana/local_fresh.f1.jpg' },
  { category: 'fruits-vegetables', name: 'Banana - FreshPick', img: 'images/fruits-vegetables/banana/local_fresh.f1.jpg' },
  { category: 'fruits-vegetables', name: 'Tomato - Local Farm', img: 'images/fruits-vegetables/tomato/local_fresh.f1.jpg' },
  { category: 'fruits-vegetables', name: 'Tomato - FreshPick', img: 'images/fruits-vegetables/tomato/local_fresh.f1.jpg' },
  { category: 'fruits-vegetables', name: 'Potato - Local Farm', img: 'images/fruits-vegetables/potato/local_fresh.f1.jpg' },
  { category: 'fruits-vegetables', name: 'Potato - FreshPick', img: 'images/fruits-vegetables/potato/local_fresh.f1.jpg' },
  { category: 'fruits-vegetables', name: 'Carrot - Local Farm', img: 'images/fruits-vegetables/carrot/local_fresh.f1.jpg' },
  { category: 'fruits-vegetables', name: 'Carrot - FreshPick', img: 'images/fruits-vegetables/carrot/local_fresh.f1.jpg' },

  // Divyan — Personal Care
  { category: 'personal-care', name: 'Shampoo - Dove', img: 'images/personal-care/shampoo/dove_f1.jpg' },
  { category: 'personal-care', name: 'Shampoo - Clinic Plus', img: 'images/personal-care/shampoo/clinic_plus_f2.jpg' },
  { category: 'personal-care', name: 'Soap - Lux', img: 'images/personal-care/soap/lux_f1.jpg' },
  { category: 'personal-care', name: 'Soap - Dove', img: 'images/personal-care/soap/dove_f2.jpg' },
  { category: 'personal-care', name: 'Toothpaste - Colgate', img: 'images/personal-care/toothpaste/colgate_f1.jpg' },
  { category: 'personal-care', name: 'Toothpaste - Pepsodent', img: 'images/personal-care/toothpaste/pepsodent_f2.jpg' },
  { category: 'personal-care', name: 'Face Wash - Himalaya', img: 'images/personal-care/face_wash/himalaya_f1.jpg' },
  { category: 'personal-care', name: 'Face Wash - Garnier', img: 'images/personal-care/face_wash/garnier_f2.jpg' },
  { category: 'personal-care', name: 'Body Lotion - Nivea', img: 'images/personal-care/body_lotion/nivea_f1.jpg' },
  { category: 'personal-care', name: 'Body Lotion - Vaseline', img: 'images/personal-care/body_lotion/vaseline_f2.jpg' },

  // Divyan — Kitchen Essentials
  { category: 'kitchen-essentials', name: 'Cooking Oil - Fortune', img: 'images/kitchen-essentials/cooking_oil/fortune_f1.jpg' },
  { category: 'kitchen-essentials', name: 'Cooking Oil - Gold Winner', img: 'images/kitchen-essentials/cooking_oil/gold_winner_f2.jpg' },
  { category: 'kitchen-essentials', name: 'Rice - India Gate', img: 'images/kitchen-essentials/rice/india_gate_f1.jpg' },
  { category: 'kitchen-essentials', name: 'Rice - Ponni', img: 'images/kitchen-essentials/rice/ponni_f2.jpg' },
  { category: 'kitchen-essentials', name: 'Wheat Flour - Aashirvaad', img: 'images/kitchen-essentials/wheat_flour/aashirvaad_f1.jpg' },
  { category: 'kitchen-essentials', name: 'Wheat Flour - Pillsbury', img: 'images/kitchen-essentials/wheat_flour/pillsbury_f2.jpg' },
  { category: 'kitchen-essentials', name: 'Masala - Sakthi', img: 'images/kitchen-essentials/masala/sakthi_f1.jpg' },
  { category: 'kitchen-essentials', name: 'Masala - Aachi', img: 'images/kitchen-essentials/masala/aachi_f2.jpg' },
  { category: 'kitchen-essentials', name: 'Salt - Tata', img: 'images/kitchen-essentials/salt/tata_f1.jpg' },
  { category: 'kitchen-essentials', name: 'Salt - Aashirvaad', img: 'images/kitchen-essentials/salt/aashirvaad_f2.jpg' },

  // Shivapriya — Electronics
  { category: 'electronics', name: 'Mobile Phone - Samsung', img: 'images/electronics/mobile_phone/samsung_f1.jpg' },
  { category: 'electronics', name: 'Mobile Phone - Redmi', img: 'images/electronics/mobile_phone/redmi_f2.jpg' },
  { category: 'electronics', name: 'Headphones - Boat', img: 'images/electronics/headphones/boat_f1.jpg' },
  { category: 'electronics', name: 'Headphones - JBL', img: 'images/electronics/headphones/jbl_f2.jpg' },
  { category: 'electronics', name: 'Power Bank - Mi', img: 'images/electronics/power_bank/mi_f1.jpg' },
  { category: 'electronics', name: 'Power Bank - Realme', img: 'images/electronics/power_bank/realme_f2.jpg' },
  { category: 'electronics', name: 'USB Cable - Portronics', img: 'images/electronics/usb_cable/portronics_f1.jpg' },
  { category: 'electronics', name: 'USB Cable - Mi', img: 'images/electronics/usb_cable/mi_f2.jpg' },
  { category: 'electronics', name: 'Bluetooth Speaker - JBL', img: 'images/electronics/bluetooth_speaker/jbl_f1.jpg' },
  { category: 'electronics', name: 'Bluetooth Speaker - Boat', img: 'images/electronics/bluetooth_speaker/boat_f2.jpg' },

  // Shivapriya — Fashion
  { category: 'fashion', name: 'T-shirt - Puma', img: 'images/fashion/t_shirt/puma_f1.jpg' },
  { category: 'fashion', name: 'T-shirt - Adidas', img: 'images/fashion/t_shirt/adidas_f2.jpg' },
  { category: 'fashion', name: 'Jeans - Levis', img: 'images/fashion/jeans/levis_f1.jpg' },
  { category: 'fashion', name: 'Jeans - Wrangler', img: 'images/fashion/jeans/wrangler_f2.jpg' },
  { category: 'fashion', name: 'Sneakers - Nike', img: 'images/fashion/sneakers/nike_f1.jpg' },
  { category: 'fashion', name: 'Sneakers - Puma', img: 'images/fashion/sneakers/puma_f2.jpg' },
  { category: 'fashion', name: 'Jacket - Allen Solly', img: 'images/fashion/jacket/allen_solly_f1.jpg' },
  { category: 'fashion', name: 'Jacket - Peter England', img: 'images/fashion/jacket/peter_england_f2.jpg' },
  { category: 'fashion', name: 'Sunglasses - Fastrack', img: 'images/fashion/sunglasses/fastrack_f1.jpg' },
  { category: 'fashion', name: 'Sunglasses - Ray-Ban', img: 'images/fashion/sunglasses/rayban_f2.jpg' },

  // Shivapriya — Beverages
  { category: 'beverages', name: 'Tea - Tata Tea', img: 'images/beverages/tea/tata_tea_f1.jpg' },
  { category: 'beverages', name: 'Tea - Red Label', img: 'images/beverages/tea/red_label_f2.jpg' },
  { category: 'beverages', name: 'Coffee - Bru', img: 'images/beverages/coffee/bru_f1.jpg' },
  { category: 'beverages', name: 'Coffee - Nescafe', img: 'images/beverages/coffee/nescafe_f2.jpg' },
  { category: 'beverages', name: 'Fruit Juice - Tropicana', img: 'images/beverages/fruit_juice/tropicana_f1.jpg' },
  { category: 'beverages', name: 'Fruit Juice - Real', img: 'images/beverages/fruit_juice/real_f2.jpg' },
  { category: 'beverages', name: 'Soft Drink - Pepsi', img: 'images/beverages/soft_drink/pepsi_f1.jpg' },
  { category: 'beverages', name: 'Soft Drink - Coca-Cola', img: 'images/beverages/soft_drink/coca_cola_f2.jpg' },
  { category: 'beverages', name: 'Energy Drink - Red Bull', img: 'images/beverages/energy_drink/red_bull_f1.jpg' },
  { category: 'beverages', name: 'Energy Drink - Monster', img: 'images/beverages/energy_drink/monster_f2.jpg' }
];

const categoryNames = {
  'all': 'All Products',
  'offer': 'All Offer Products',
  'dairy-products': 'Dairy Products',
  'fruits-vegetables': 'Fruits & Vegetables',
  'household-cleaning': 'Household & Cleaning',
  'kitchen-essentials': 'Kitchen Essentials',
  'personal-care': 'Personal Care',
  'electronics': 'Electronics',
  'fashion': 'Fashion',
  'beverages': 'Beverages'
};


const categoryOffers = {
  'dairy-products': {0: 28, 1: 9, 4: 8, 6: 28, 9: 26},
  'household-cleaning': {0: 21, 1: 11, 6: 12, 7: 24, 8: 7},
  'fruits-vegetables': {0: 27, 3: 18, 5: 12, 6: 19, 8: 22},
  'personal-care': {0: 15, 1: 9, 4: 18, 6: 13, 9: 27},
  'kitchen-essentials': {0: 16, 1: 32, 3: 8, 5: 16, 9: 24},
  'electronics': {0: 17, 4: 34, 7: 7, 8: 14, 9: 22},
  'fashion': {0: 14, 3: 12, 5: 26, 8: 29, 9: 6},
  'beverages': {1: 19, 2: 10, 3: 25, 8: 16, 9: 31}
};

const staticPrices = {};
const staticRatings = {};
products.forEach((p, i) => {
  staticPrices[p.name] = 60 + (i % 5) * 10;
  staticRatings[p.name] = (4 + (i % 3) * 0.3).toFixed(1);
});

const grid = document.getElementById('productGrid');
const filter = document.getElementById('categoryFilter') || document.getElementById('categorySelect');
let cart = JSON.parse(localStorage.getItem('cart')) || {};
let currentCategory = 'all';
let selectedFilters = { product: '', brand: '', pack: '' };

function saveCart() {
  localStorage.setItem('cart', JSON.stringify(cart));
  updateCartCount();
}

function updateCartCount() {
  const count = Object.values(cart).reduce((sum, qty) => sum + qty, 0);
  const el = document.getElementById('cartCount');
  if (el) el.textContent = count;
}

function isSolid(category) {
  return ['fruits-vegetables', 'kitchen-essentials', 'personal-care', 'fashion'].includes(category);
}

function isLiquid(category) {
  return ['dairy-products', 'household-cleaning', 'beverages'].includes(category);
}

function isColorCategory(category) {
  return ['electronics', 'fashion'].includes(category);
}

function getVariantOptions(category) {
  if (isColorCategory(category)) return ['White', 'Black', 'Red', 'Blue'];
  if (isSolid(category)) return ['500g', '1kg'];
  if (isLiquid(category)) return ['500ml', '1L'];
  return [];
}

function getAdjustedPrice(base, variant) {
  if (!variant) return base;
  if (variant.includes('1kg') || variant.includes('1L')) return base * 2;
  return base;
}

function showProducts(cat, customList = null) {
  grid.innerHTML = '';

  let filtered;
  if (cat === 'offer') {
    filtered = products.filter((p, i) => {
      const idx = products.findIndex(prod => prod.name === p.name);
      return categoryOffers[p.category] && categoryOffers[p.category][idx % 10];
    });
  } else if (cat === 'all') {
    filtered = products;
  } else {
    filtered = products.filter(p => p.category === cat);
  }

  filtered = filtered.filter(p => {
    const prodMatch = !selectedFilters.product || p.name.split(' - ')[0] === selectedFilters.product;
    const brandMatch = !selectedFilters.brand || p.name.split(' - ')[1] === selectedFilters.brand;
    const packMatch = !selectedFilters.pack || getVariantOptions(p.category).includes(selectedFilters.pack);
    return prodMatch && brandMatch && packMatch;
  });

  const title = document.getElementById('categoryTitle');
  if (title) title.textContent = categoryNames[cat] || 'All Products';

  updateFilters(cat, filtered);

  filtered.forEach((p, i) => {
    const index = products.findIndex(prod => prod.name === p.name);
    const offerPercent = categoryOffers[p.category] && categoryOffers[p.category][index % 10];
    const basePrice = staticPrices[p.name];
    const rating = staticRatings[p.name];
    const variantOptions = getVariantOptions(p.category);
    const selectedVariant = selectedFilters.pack && variantOptions.includes(selectedFilters.pack) ? selectedFilters.pack : variantOptions[0];
    const variantHTML = variantOptions.map(opt => `<option value="${opt}" ${opt === selectedVariant ? 'selected' : ''}>${opt}</option>`).join('');
    const priceAdjusted = getAdjustedPrice(basePrice, selectedVariant);
    const discount = offerPercent ? Math.floor(priceAdjusted * (offerPercent / 100)) : 0;
    const finalPrice = priceAdjusted - discount;
    const oldPrice = offerPercent ? `<s>₹${priceAdjusted}</s>` : '';
    const qty = cart[p.name] || 0;

    const card = document.createElement('div');
    card.className = 'product-card';
    card.innerHTML = `
      ${offerPercent ? `<div class="discount-tag">${offerPercent}% OFF</div>` : ''}
      <img src="${p.img}" alt="${p.name}">
      <h3>${p.name}</h3>
      <select class="variant-select" onchange="this.nextElementSibling.innerHTML = updatePrice('${p.name}', this.value, ${basePrice}, ${offerPercent || 0})">
        ${variantHTML}
      </select>
      <p class="price-display">${oldPrice} <strong>₹${finalPrice}</strong></p>
      <div class="rating">⭐ ${rating}</div>
      ${qty > 0 ? `
        <div class="quantity-control">
          <button onclick="decreaseQty('${p.name}')">-</button>
          <span>${qty}</span>
          <button onclick="increaseQty('${p.name}')">+</button>
        </div>
      ` : `<button class="add-btn" onclick="increaseQty('${p.name}')">Add</button>`}
      <p class="delivery-info">Delivery by Tomorrow, 6–8 AM | ₹10 extra for express</p>
    `;
    grid.appendChild(card);
  });
}

function updatePrice(name, variant, base, offerPercent) {
  const price = getAdjustedPrice(base, variant);
  const discount = offerPercent ? Math.floor(price * (offerPercent / 100)) : 0;
  const final = price - discount;
  const old = offerPercent ? `<s>₹${price}</s>` : '';
  return `${old} <strong>₹${final}</strong>`;
}

function updateFilters(category, productList) {
  const sidebar = document.querySelector('.sidebar');
  sidebar.innerHTML = '<h3>Filter By</h3>';
  sidebar.innerHTML += `
    <button onclick="filterTab('all')">All Products</button>
    <button onclick="filterTab('offer')">All Offer Products</button>
  `;

  const createSelectGroup = (label, id, options, filterKey) => {
    const group = document.createElement('div');
    group.className = 'filter-group';
    const html = `
      <label for="${id}">${label}</label>
      <select id="${id}" onchange="selectedFilters['${filterKey}'] = this.value; showProducts(currentCategory)">
        <option value="">Choose ${label}</option>
        ${options.map(opt => `<option value="${opt}">${opt}</option>`).join('')}
      </select>
    `;
    group.innerHTML = html;
    return group;
  };

  const productNames = [...new Set(productList.map(p => p.name.split(' - ')[0]))];
  const brands = [...new Set(productList.map(p => p.name.split(' - ')[1]))].filter(Boolean);

  sidebar.appendChild(createSelectGroup('Product', 'productSelect', productNames, 'product'));
  sidebar.appendChild(createSelectGroup('Brand', 'brandSelect', brands, 'brand'));

  const sizeOrColor = isColorCategory(category) ? ['White', 'Black', 'Red', 'Blue'] : isSolid(category) ? ['500g', '1kg'] : isLiquid(category) ? ['500ml', '1L'] : [];
  if (sizeOrColor.length > 0) {
    sidebar.appendChild(createSelectGroup('Pack Size / Color', 'packSelect', sizeOrColor, 'pack'));
  }
}

function increaseQty(name) {
  cart[name] = (cart[name] || 0) + 1;
  saveCart();
  showProducts(currentCategory);
}

function decreaseQty(name) {
  if (cart[name]) {
    cart[name]--;
    if (cart[name] <= 0) delete cart[name];
    saveCart();
    showProducts(currentCategory);
  }
}

if (filter) {
  filter.addEventListener('change', e => {
    currentCategory = e.target.value;
    showProducts(currentCategory);
  });
}

function filterTab(cat) {
  currentCategory = cat;
  showProducts(cat);
}

window.addEventListener('load', () => {
  updateCartCount();
  const urlParams = new URLSearchParams(window.location.search);
  const catParam = urlParams.get('cat');
  currentCategory = catParam || 'all';
  showProducts(currentCategory);
});

const searchInput = document.getElementById('searchInput');
const searchDropdown = document.getElementById('searchDropdown');

searchInput.addEventListener('input', function () {
  const term = this.value.toLowerCase();
  searchDropdown.innerHTML = '';
  if (!term) {
    searchDropdown.style.display = 'none';
    return;
  }

  const matched = products.filter(p => p.name.toLowerCase().includes(term)).slice(0, 6);

  matched.forEach(p => {
    const item = document.createElement('div');
    item.className = 'search-suggestion';
    item.innerHTML = `
      <img src="${p.img}" alt="${p.name}">
      <h4>${p.name}</h4>
      <div class="qty-btns">
        <button onclick="decreaseQty('${p.name}')">-</button>
        <span>${cart[p.name] || 0}</span>
        <button onclick="increaseQty('${p.name}')">+</button>
      </div>
    `;
    searchDropdown.appendChild(item);
  });

  searchDropdown.style.display = matched.length ? 'block' : 'none';
});

document.addEventListener('click', function (e) {
  if (!searchDropdown.contains(e.target) && e.target !== searchInput) {
    searchDropdown.style.display = 'none';
  }
});

function filterTab(cat) {
  currentCategory = cat;
  showProducts(cat);
}
